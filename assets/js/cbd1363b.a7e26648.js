"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["554126"],{478308:function(e,n,s){s.r(n),s.d(n,{metadata:()=>t,contentTitle:()=>o,default:()=>u,assets:()=>l,toc:()=>c,frontMatter:()=>i});var t=JSON.parse('{"id":"install/preparation/os-checking","title":"OS Checking","description":"\x3c!--","source":"@site/docs/install/preparation/os-checking.md","sourceDirName":"install/preparation","slug":"/install/preparation/os-checking","permalink":"/docs/dev/install/preparation/os-checking","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"OS Checking","language":"en"},"sidebar":"docs","previous":{"title":"Cluster Planning","permalink":"/docs/dev/install/preparation/cluster-planning"},"next":{"title":"Deploy Storage Compute Coupled Manually","permalink":"/docs/dev/install/deploy-manually/storage-compute-coupled-deploy-manually"}}'),r=s("785893"),a=s("250065");let i={title:"OS Checking",language:"en"},o=void 0,l={},c=[{value:"Ensure Swap Partition is Disabled",id:"ensure-swap-partition-is-disabled",level:2},{value:"Ensure Transparent Huge Pages are Disabled",id:"ensure-transparent-huge-pages-are-disabled",level:2},{value:"Ensure the System Has a Sufficiently Large Virtual Memory Area",id:"ensure-the-system-has-a-sufficiently-large-virtual-memory-area",level:2},{value:"Ensure CPU is Not Using Power-Saving Mode",id:"ensure-cpu-is-not-using-power-saving-mode",level:2},{value:"Ensure Network Connections Automatically Reset New Connections When Overflow Occurs",id:"ensure-network-connections-automatically-reset-new-connections-when-overflow-occurs",level:2},{value:"Ensure Doris-related Ports are Open or the System Firewall is Disabled",id:"ensure-doris-related-ports-are-open-or-the-system-firewall-is-disabled",level:2},{value:"Ensure the System Has a Sufficiently Large Number of Open File Descriptors",id:"ensure-the-system-has-a-sufficiently-large-number-of-open-file-descriptors",level:2},{value:"Ensure NTP Service is Installed on Cluster Deployment Machines",id:"ensure-ntp-service-is-installed-on-cluster-deployment-machines",level:2}];function d(e){let n={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"When deploying Doris, the following operating system items need to be checked:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Ensure swap partition is disabled"}),"\n",(0,r.jsx)(n.li,{children:"Ensure transparent huge pages are disabled"}),"\n",(0,r.jsx)(n.li,{children:"Ensure the system has a sufficiently large virtual memory area"}),"\n",(0,r.jsx)(n.li,{children:"Ensure CPU is not using power-saving mode"}),"\n",(0,r.jsx)(n.li,{children:"Ensure network connections automatically reset new connections when overflow occurs"}),"\n",(0,r.jsx)(n.li,{children:"Ensure Doris-related ports are open or the system firewall is disabled"}),"\n",(0,r.jsx)(n.li,{children:"Ensure the system has a sufficiently large number of open file descriptors"}),"\n",(0,r.jsx)(n.li,{children:"Ensure cluster deployment machines have NTP service installed"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"ensure-swap-partition-is-disabled",children:"Ensure Swap Partition is Disabled"}),"\n",(0,r.jsx)(n.p,{children:"When deploying Doris, it is recommended to disable the swap partition. The swap partition is used by the kernel to move some memory data to the configured swap area when it detects memory pressure. Since the kernel's strategy does not fully understand the application's behavior, it can significantly impact Doris's performance. Therefore, it is recommended to disable it."}),"\n",(0,r.jsx)(n.p,{children:"You can disable it temporarily or permanently using the following commands."}),"\n",(0,r.jsx)(n.p,{children:"To disable temporarily, the swap will be re-enabled upon the next machine restart."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"swapoff -a\n"})}),"\n",(0,r.jsxs)(n.p,{children:["To disable it permanently, use a Linux root account to comment out the swap partition in ",(0,r.jsx)(n.code,{children:"/etc/fstab"})," and restart the machine to completely disable the swap partition."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# /etc/fstab\n# <file system>        <dir>         <type>    <options>             <dump> <pass>\ntmpfs                  /tmp          tmpfs     nodev,nosuid          0      0\n/dev/sda1              /             ext4      defaults,noatime      0      1\n# /dev/sda2              none          swap      defaults              0      0\n/dev/sda3              /home         ext4      defaults,noatime      0      2\n"})}),"\n",(0,r.jsx)(n.h2,{id:"ensure-transparent-huge-pages-are-disabled",children:"Ensure Transparent Huge Pages are Disabled"}),"\n",(0,r.jsx)(n.p,{children:"In high-load, low-latency scenarios, it is recommended to disable the operating system's Transparent Huge Pages (THP) to avoid performance fluctuations and memory fragmentation issues, ensuring that Doris can use memory in a stable and efficient manner."}),"\n",(0,r.jsx)(n.p,{children:"Use the following commands to temporarily disable Transparent Huge Pages:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"echo madvise > /sys/kernel/mm/transparent_hugepage/enabled\necho madvise > /sys/kernel/mm/transparent_hugepage/defrag\n"})}),"\n",(0,r.jsx)(n.p,{children:"If you need to disable Transparent Huge Pages permanently, you can use the following command, which will take effect after the next host machine restart:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cat >> /etc/rc.d/rc.local << EOF\n   echo madvise > /sys/kernel/mm/transparent_hugepage/enabled\n   echo madvise > /sys/kernel/mm/transparent_hugepage/defrag\nEOF\nchmod +x /etc/rc.d/rc.local\n"})}),"\n",(0,r.jsx)(n.h2,{id:"ensure-the-system-has-a-sufficiently-large-virtual-memory-area",children:"Ensure the System Has a Sufficiently Large Virtual Memory Area"}),"\n",(0,r.jsxs)(n.p,{children:["To ensure Doris has enough memory mapping area to handle large amounts of data, you need to modify the size of the virtual memory area. If there is not enough memory mapping area, Doris may encounter errors like ",(0,r.jsx)(n.code,{children:"Too many open files"})," or similar during startup or runtime."]}),"\n",(0,r.jsx)(n.p,{children:"You can permanently modify the virtual memory area to at least 2000000 with the following command, and it will take effect immediately:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cat >> /etc/sysctl.conf << EOF\nvm.max_map_count = 2000000\nEOF\n\n# Take effect immediately\nsysctl -p\n"})}),"\n",(0,r.jsx)(n.h2,{id:"ensure-cpu-is-not-using-power-saving-mode",children:"Ensure CPU is Not Using Power-Saving Mode"}),"\n",(0,r.jsx)(n.p,{children:"When deploying Doris, ensure that the CPU's power-saving modes are disabled to guarantee stable high performance under high load. This prevents performance fluctuations, response delays, and system bottlenecks caused by reduced CPU frequencies, thereby enhancing Doris's reliability and throughput. If your CPU does not support Scaling Governor, you can skip this configuration."}),"\n",(0,r.jsx)(n.p,{children:"You can disable CPU power-saving mode with the following commands:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"echo 'performance' | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor\n"})}),"\n",(0,r.jsx)(n.h2,{id:"ensure-network-connections-automatically-reset-new-connections-when-overflow-occurs",children:"Ensure Network Connections Automatically Reset New Connections When Overflow Occurs"}),"\n",(0,r.jsx)(n.p,{children:"When deploying Doris, you need to ensure that when the TCP connection's send buffer overflows, the connection is immediately terminated. This prevents Doris from experiencing buffer blocking under high load or high concurrency, avoids connections being suspended for long periods, and thereby improves the system's responsiveness and stability."}),"\n",(0,r.jsx)(n.p,{children:"You can permanently configure the system to automatically reset new connections with the following commands, and it will take effect immediately:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cat >> /etc/sysctl.conf << EOF\nnet.ipv4.tcp_abort_on_overflow=1\nEOF\n\n# Take effect immediately\nsysctl -p\n"})}),"\n",(0,r.jsx)(n.h2,{id:"ensure-doris-related-ports-are-open-or-the-system-firewall-is-disabled",children:"Ensure Doris-related Ports are Open or the System Firewall is Disabled"}),"\n",(0,r.jsx)(n.p,{children:"If you find that ports are not accessible, you can try disabling the firewall to confirm whether it is caused by the local firewall. If the firewall is the cause, you can open the corresponding ports for Doris's various components based on their configuration."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"sudo systemctl stop firewalld.service\nsudo systemctl disable firewalld.service\n"})}),"\n",(0,r.jsx)(n.h2,{id:"ensure-the-system-has-a-sufficiently-large-number-of-open-file-descriptors",children:"Ensure the System Has a Sufficiently Large Number of Open File Descriptors"}),"\n",(0,r.jsx)(n.p,{children:"Since Doris relies on a large number of files to manage table data, it is necessary to increase the system's limit on the number of open files per program."}),"\n",(0,r.jsx)(n.p,{children:"You can adjust the maximum number of file descriptors using the following commands. After making the adjustments, you need to restart the session for the configuration to take effect:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"vi /etc/security/limits.conf \n* soft nofile 1000000\n* hard nofile 1000000\n"})}),"\n",(0,r.jsx)(n.h2,{id:"ensure-ntp-service-is-installed-on-cluster-deployment-machines",children:"Ensure NTP Service is Installed on Cluster Deployment Machines"}),"\n",(0,r.jsx)(n.p,{children:"Doris requires the metadata time accuracy to be less than 5000ms. Therefore, all machines in the cluster must synchronize their clocks to prevent metadata inconsistencies caused by clock issues, which could lead to service abnormalities."}),"\n",(0,r.jsx)(n.p,{children:"Typically, you can ensure clock synchronization across nodes by configuring the NTP service."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"sudo systemctl start ntpd.service\nsudo systemctl enable ntpd.service\n"})})]})}function u(e={}){let{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},250065:function(e,n,s){s.d(n,{Z:function(){return o},a:function(){return i}});var t=s(667294);let r={},a=t.createContext(r);function i(e){let n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);